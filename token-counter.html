<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Token Counter</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        textarea { width: 100%; min-height: 200px; font-family: monospace; padding: 10px; }
        button { padding: 8px 16px; cursor: pointer; margin: 5px 5px 5px 0; }
        button:disabled { opacity: 0.6; cursor: not-allowed; }
        select { padding: 8px; font-size: 14px; }
        .output { background: #f5f5f5; padding: 15px; margin-top: 10px; border-radius: 4px; }
        .error { color: #c00; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; }
        .stat-box { background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 4px; text-align: center; }
        .stat-value { font-size: 2em; font-weight: bold; color: #333; }
        .stat-label { color: #666; font-size: 0.9em; }
        .controls { display: flex; flex-wrap: wrap; align-items: center; gap: 10px; margin: 15px 0; }
        #status { margin-top: 10px; padding: 10px; border-radius: 4px; }
        #status.ready { background: #e8f5e9; color: #2e7d32; }
        #status.loading { background: #fff3e0; color: #e65100; }
        #status.error { background: #ffebee; color: #c62828; }
    </style>
</head>
<body>
    <h1>Token Counter</h1>
    <p>Count tokens in text using OpenAI's tiktoken tokenizer (js-tiktoken).</p>

    <div id="status" class="loading">Loading tokenizer...</div>

    <div>
        <label for="input">Text to tokenize:</label>
        <textarea id="input" placeholder="Paste your text here..."></textarea>
    </div>

    <div class="controls">
        <label for="model">Model/Encoding:</label>
        <select id="model">
            <optgroup label="GPT-4o">
                <option value="o200k_base" selected>GPT-4o / GPT-4o-mini (o200k_base)</option>
            </optgroup>
            <optgroup label="GPT-4 / GPT-3.5">
                <option value="cl100k_base">GPT-4 / GPT-3.5-turbo (cl100k_base)</option>
            </optgroup>
            <optgroup label="Legacy">
                <option value="p50k_base">text-davinci-003 / Codex (p50k_base)</option>
                <option value="r50k_base">GPT-3 / text-davinci-002 (r50k_base)</option>
            </optgroup>
        </select>
        <button id="count" disabled>Count Tokens</button>
        <button id="clear">Clear</button>
    </div>

    <div id="output" class="output" style="display: none;">
        <div class="stats">
            <div class="stat-box">
                <div class="stat-value" id="token-count">0</div>
                <div class="stat-label">Tokens</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="char-count">0</div>
                <div class="stat-label">Characters</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="word-count">0</div>
                <div class="stat-label">Words</div>
            </div>
            <div class="stat-box">
                <div class="stat-value" id="ratio">0</div>
                <div class="stat-label">Chars/Token</div>
            </div>
        </div>
    </div>

    <script type="module">
        import { getEncoding } from 'https://esm.sh/js-tiktoken@1.0.12';

        const inputEl = document.getElementById('input');
        const outputEl = document.getElementById('output');
        const modelEl = document.getElementById('model');
        const countBtn = document.getElementById('count');
        const statusEl = document.getElementById('status');

        const encoders = {};

        async function getEncoder(encodingName) {
            if (!encoders[encodingName]) {
                encoders[encodingName] = getEncoding(encodingName);
            }
            return encoders[encodingName];
        }

        async function init() {
            try {
                // Pre-load the default encoding
                await getEncoder('o200k_base');
                countBtn.disabled = false;
                statusEl.textContent = 'Ready! Paste text and click "Count Tokens".';
                statusEl.className = 'ready';
            } catch (e) {
                statusEl.textContent = 'Error loading: ' + e.message;
                statusEl.className = 'error';
                console.error(e);
            }
        }

        async function countTokens() {
            const text = inputEl.value;
            const encoding = modelEl.value;

            if (!text.trim()) {
                outputEl.style.display = 'none';
                return;
            }

            try {
                const enc = await getEncoder(encoding);
                const tokens = enc.encode(text);
                const tokenCount = tokens.length;
                const charCount = text.length;
                const wordCount = text.trim().split(/\s+/).filter(w => w.length > 0).length;
                const ratio = tokenCount > 0 ? (charCount / tokenCount).toFixed(2) : 0;

                document.getElementById('token-count').textContent = tokenCount.toLocaleString();
                document.getElementById('char-count').textContent = charCount.toLocaleString();
                document.getElementById('word-count').textContent = wordCount.toLocaleString();
                document.getElementById('ratio').textContent = ratio;

                outputEl.style.display = 'block';
                outputEl.classList.remove('error');

            } catch (e) {
                outputEl.style.display = 'block';
                outputEl.innerHTML = '<p class="error">Error: ' + e.message + '</p>';
            }
        }

        countBtn.addEventListener('click', countTokens);

        document.getElementById('clear').addEventListener('click', () => {
            inputEl.value = '';
            outputEl.style.display = 'none';
        });

        // Auto-count on input change (debounced)
        let debounceTimer;
        inputEl.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                if (!countBtn.disabled && inputEl.value.trim()) {
                    countTokens();
                }
            }, 300);
        });

        // Re-count when model changes
        modelEl.addEventListener('change', () => {
            if (!countBtn.disabled && inputEl.value.trim()) {
                countTokens();
            }
        });

        // Initialize on load
        init();
    </script>
</body>
</html>
